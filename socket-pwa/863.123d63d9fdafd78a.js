"use strict";(self.webpackChunksocket_pwa=self.webpackChunksocket_pwa||[]).push([[863],{6863:(ut,v,r)=>{r.r(v),r.d(v,{PickingModule:()=>at});var u=r(9808),T=r(9539),C=r(5898),x=r(2340),t=r(5e3),U=r(327);let y=(()=>{class i extends C.sk{constructor(){super({url:x.N.wsUrl,options:{}}),this.ioSocket.auth={"x-token":localStorage.getItem("access_token")}}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-picking"]],features:[t.qOj],decls:3,vars:0,consts:[[1,"container-fluid","mt-4"]],template:function(e,n){1&e&&(t._UZ(0,"app-navbar"),t.TgZ(1,"div",0),t._UZ(2,"router-outlet"),t.qZA())},directives:[U.S,T.lC],encapsulation:2}),i})();var c=r(2382),_=r(7579),w=r(520);const{endpoint:M}=x.N,m=`${M}/picking`;let h=(()=>{class i{constructor(e){this.http=e}list(e){return this.http.get(`${m}/list/${e}`)}statusUser(e){return this.http.get(`${m}/user/status/${e}`)}listUserPicking(e){return this.http.get(`${m}/user/list/${e}`)}saveListByUser(e){return this.http.post(`${m}/user`,e)}listDetail(e){return this.http.get(`${m}/${e}`)}update(e,n){return this.http.put(`${m}/${e}`,n)}check(e,n){return this.http.put(`${m}/detail/${e}`,n)}}return i.\u0275fac=function(e){return new(e||i)(t.LFG(w.eN))},i.\u0275prov=t.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var Z=r(1134),g=r(9444);const D=function(){return["fas","check"]};function P(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"tr",12),t.TgZ(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td",13),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.qZA(),t.TgZ(7,"td"),t.TgZ(8,"button",14),t.NdJ("click",function(){const l=t.CHM(e).$implicit;return t.oxw().check(l)}),t._UZ(9,"fa-icon",15),t.qZA(),t.qZA(),t.qZA()}if(2&i){const e=s.$implicit,n=s.index;t.Q6J("ngClass",e.complete?"bg-success text-white":""),t.xp6(2),t.Oqu(n+1),t.xp6(2),t.Oqu(null==e?null:e.name),t.xp6(2),t.Oqu(null==e?null:e.bottles),t.xp6(2),t.Q6J("disabled",e.complete),t.xp6(1),t.Q6J("icon",t.DdM(6,D))}}let S=(()=>{class i{constructor(e,n){this.pickingService=e,this.bsModalRef=n,this.picking="",this.bottles=[]}ngOnInit(){this.getDetail()}onConfirm(){this.bsModalRef.content.onClose.next(!0),this.bsModalRef.hide()}onCancel(){this.bsModalRef.content.onClose.next(!1),this.bsModalRef.hide()}check(e){this.pickingService.check(e._id,{complete:!0}).subscribe(()=>this.getDetail())}getDetail(){this.pickingService.listDetail(this.picking._id).subscribe(e=>{this.bottles=e.detail.filter(n=>n.bottles>0)})}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(h),t.Y36(Z.UZ))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-bottle-detail"]],inputs:{picking:"picking"},decls:32,vars:4,consts:[[1,"scrollModal"],[1,"modal-header"],[1,"modal-title","d-flex","justify-content-between","w-100"],[1,"modal-body"],[1,"table-responsive"],[1,"table","table-sm","table-bordered"],[1,"fw-bold","text-center","table-primary",2,"font-size","14px"],["class","text-center align-middle",3,"ngClass",4,"ngFor","ngForOf"],[1,"text-center","align-middle"],["colspan","2"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary","btn-mobile",3,"click"],[1,"text-center","align-middle",3,"ngClass"],[1,"text-start"],[1,"btn","btn-success",3,"disabled","click"],[3,"icon"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"div",1),t.TgZ(2,"h5",2),t.TgZ(3,"span"),t._uU(4,"Botellas"),t.qZA(),t.TgZ(5,"span"),t._uU(6),t.qZA(),t.TgZ(7,"span"),t._uU(8),t.qZA(),t.qZA(),t.qZA(),t.TgZ(9,"div",3),t.TgZ(10,"div",4),t.TgZ(11,"table",5),t.TgZ(12,"thead"),t.TgZ(13,"tr",6),t.TgZ(14,"th"),t._uU(15,"#"),t.qZA(),t.TgZ(16,"th"),t._uU(17,"Nombre"),t.qZA(),t.TgZ(18,"th"),t._uU(19,"Botellas"),t.qZA(),t.TgZ(20,"th"),t._uU(21,"Opciones"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(22,"tbody"),t.YNc(23,P,10,7,"tr",7),t.TgZ(24,"tr",8),t.TgZ(25,"th",9),t._uU(26,"Total"),t.qZA(),t.TgZ(27,"th"),t._uU(28),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(29,"div",10),t.TgZ(30,"button",11),t.NdJ("click",function(){return n.onCancel()}),t._uU(31,"Cerrar"),t.qZA(),t.qZA(),t.qZA()),2&e&&(t.xp6(6),t.hij("Ruta: ",null==n.picking?null:n.picking.route,""),t.xp6(2),t.hij("Viaje: ",null==n.picking?null:n.picking.travel,""),t.xp6(15),t.Q6J("ngForOf",n.bottles),t.xp6(5),t.Oqu(null==n.picking?null:n.picking.bottles))},directives:[u.sg,u.mk,g.BN],styles:[".scrollModal[_ngcontent-%COMP%]{max-width:95vw;max-height:95vh}.table-responsive[_ngcontent-%COMP%]{max-height:75vh}thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{position:sticky;top:0;z-index:10}"]}),i})();const O=function(){return["fas","check"]};function N(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"tr",12),t.TgZ(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td",13),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.qZA(),t.TgZ(7,"td"),t.TgZ(8,"button",14),t.NdJ("click",function(){const l=t.CHM(e).$implicit;return t.oxw().check(l)}),t._UZ(9,"fa-icon",15),t.qZA(),t.qZA(),t.qZA()}if(2&i){const e=s.$implicit,n=s.index;t.Q6J("ngClass",e.complete?"bg-success text-white":""),t.xp6(2),t.Oqu(n+1),t.xp6(2),t.Oqu(null==e?null:e.name),t.xp6(2),t.Oqu(null==e?null:e.boxes),t.xp6(2),t.Q6J("disabled",e.complete),t.xp6(1),t.Q6J("icon",t.DdM(6,O))}}let J=(()=>{class i{constructor(e,n){this.pickingService=e,this.bsModalRef=n,this.picking="",this.boxes=[]}ngOnInit(){this.getDetail()}onConfirm(){this.bsModalRef.content.onClose.next(!0),this.bsModalRef.hide()}onCancel(){this.bsModalRef.content.onClose.next(!1),this.bsModalRef.hide()}check(e){this.pickingService.check(e._id,{complete:!0}).subscribe(()=>this.getDetail())}getDetail(){this.pickingService.listDetail(this.picking._id).subscribe(e=>{this.boxes=e.detail.filter(n=>n.boxes>0)})}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(h),t.Y36(Z.UZ))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-box-detail"]],inputs:{picking:"picking"},decls:32,vars:4,consts:[[1,"scrollModal"],[1,"modal-header"],[1,"modal-title","d-flex","justify-content-between","w-100"],[1,"modal-body"],[1,"table-responsive"],[1,"table","table-sm","table-bordered"],[1,"fw-bold","text-center","table-primary",2,"font-size","14px"],["class","text-center align-middle",3,"ngClass",4,"ngFor","ngForOf"],[1,"text-center","align-middle"],["colspan","2"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary","btn-mobile",3,"click"],[1,"text-center","align-middle",3,"ngClass"],[1,"text-start"],[1,"btn","btn-success",3,"disabled","click"],[3,"icon"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"div",1),t.TgZ(2,"h5",2),t.TgZ(3,"span"),t._uU(4,"Cajas"),t.qZA(),t.TgZ(5,"span"),t._uU(6),t.qZA(),t.TgZ(7,"span"),t._uU(8),t.qZA(),t.qZA(),t.qZA(),t.TgZ(9,"div",3),t.TgZ(10,"div",4),t.TgZ(11,"table",5),t.TgZ(12,"thead"),t.TgZ(13,"tr",6),t.TgZ(14,"th"),t._uU(15,"#"),t.qZA(),t.TgZ(16,"th"),t._uU(17,"Nombre"),t.qZA(),t.TgZ(18,"th"),t._uU(19,"Cajas"),t.qZA(),t.TgZ(20,"th"),t._uU(21,"Opciones"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(22,"tbody"),t.YNc(23,N,10,7,"tr",7),t.TgZ(24,"tr",8),t.TgZ(25,"th",9),t._uU(26,"Total"),t.qZA(),t.TgZ(27,"th"),t._uU(28),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(29,"div",10),t.TgZ(30,"button",11),t.NdJ("click",function(){return n.onCancel()}),t._uU(31,"Cerrar"),t.qZA(),t.qZA(),t.qZA()),2&e&&(t.xp6(6),t.hij("Ruta: ",null==n.picking?null:n.picking.route,""),t.xp6(2),t.hij("Viaje: ",null==n.picking?null:n.picking.travel,""),t.xp6(15),t.Q6J("ngForOf",n.boxes),t.xp6(5),t.Oqu(null==n.picking?null:n.picking.boxes))},directives:[u.sg,u.mk,g.BN],styles:[".scrollModal[_ngcontent-%COMP%]{max-width:95vw;max-height:95vh}.table-responsive[_ngcontent-%COMP%]{max-height:75vh}thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{position:sticky;top:0;z-index:10}"]}),i})();const R=function(){return["fas","check"]};function I(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"tr",12),t.TgZ(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td",13),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.qZA(),t.TgZ(7,"td"),t.TgZ(8,"button",14),t.NdJ("click",function(){const l=t.CHM(e).$implicit;return t.oxw().check(l)}),t._UZ(9,"fa-icon",15),t.qZA(),t.qZA(),t.qZA()}if(2&i){const e=s.$implicit,n=s.index;t.Q6J("ngClass",e.complete?"bg-success text-white":""),t.xp6(2),t.Oqu(n+1),t.xp6(2),t.Oqu(null==e?null:e.name),t.xp6(2),t.Oqu(null==e?null:e.packages),t.xp6(2),t.Q6J("disabled",e.complete),t.xp6(1),t.Q6J("icon",t.DdM(6,R))}}let F=(()=>{class i{constructor(e,n){this.pickingService=e,this.bsModalRef=n,this.picking="",this.packages=[]}ngOnInit(){this.getDetail()}onConfirm(){this.bsModalRef.content.onClose.next(!0),this.bsModalRef.hide()}onCancel(){this.bsModalRef.content.onClose.next(!1),this.bsModalRef.hide()}check(e){this.pickingService.check(e._id,{complete:!0}).subscribe(()=>this.getDetail())}getDetail(){this.pickingService.listDetail(this.picking._id).subscribe(e=>{this.packages=e.detail.filter(n=>n.packages>0)})}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(h),t.Y36(Z.UZ))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-package-detail"]],inputs:{picking:"picking"},decls:32,vars:4,consts:[[1,"scrollModal"],[1,"modal-header"],[1,"modal-title","d-flex","justify-content-between","w-100"],[1,"modal-body"],[1,"table-responsive"],[1,"table","table-sm","table-bordered"],[1,"fw-bold","text-center","table-primary",2,"font-size","14px"],["class","text-center align-middle",3,"ngClass",4,"ngFor","ngForOf"],[1,"text-center","align-middle"],["colspan","2"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary","btn-mobile",3,"click"],[1,"text-center","align-middle",3,"ngClass"],[1,"text-start"],[1,"btn","btn-success",3,"disabled","click"],[3,"icon"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"div",1),t.TgZ(2,"h5",2),t.TgZ(3,"span"),t._uU(4,"Paquetes"),t.qZA(),t.TgZ(5,"span"),t._uU(6),t.qZA(),t.TgZ(7,"span"),t._uU(8),t.qZA(),t.qZA(),t.qZA(),t.TgZ(9,"div",3),t.TgZ(10,"div",4),t.TgZ(11,"table",5),t.TgZ(12,"thead"),t.TgZ(13,"tr",6),t.TgZ(14,"th"),t._uU(15,"#"),t.qZA(),t.TgZ(16,"th"),t._uU(17,"Nombre"),t.qZA(),t.TgZ(18,"th"),t._uU(19,"Paquetes"),t.qZA(),t.TgZ(20,"th"),t._uU(21,"Opciones"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(22,"tbody"),t.YNc(23,I,10,7,"tr",7),t.TgZ(24,"tr",8),t.TgZ(25,"th",9),t._uU(26,"Total"),t.qZA(),t.TgZ(27,"th"),t._uU(28),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(29,"div",10),t.TgZ(30,"button",11),t.NdJ("click",function(){return n.onCancel()}),t._uU(31,"Cerrar"),t.qZA(),t.qZA(),t.qZA()),2&e&&(t.xp6(6),t.hij("Ruta: ",null==n.picking?null:n.picking.route,""),t.xp6(2),t.hij("Viaje: ",null==n.picking?null:n.picking.travel,""),t.xp6(15),t.Q6J("ngForOf",n.packages),t.xp6(5),t.Oqu(null==n.picking?null:n.picking.packages))},directives:[u.sg,u.mk,g.BN],styles:[".scrollModal[_ngcontent-%COMP%]{max-width:95vw;max-height:95vh}.table-responsive[_ngcontent-%COMP%]{max-height:75vh}thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{position:sticky;top:0;z-index:10}"]}),i})();var k=r(7556),q=r(8620),L=r(3722);function B(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"a",17),t.NdJ("click",function(){return t.CHM(e),t.oxw().closeModal()}),t._uU(1,"Cerrar"),t.qZA()}}function Q(i,s){if(1&i&&(t.TgZ(0,"h3",18),t._uU(1),t.ALo(2,"uppercase"),t.qZA()),2&i){const e=t.oxw();t.xp6(1),t.hij("",t.lcZ(2,1,e.message)," !!!")}}function j(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"label",19),t.TgZ(1,"input",20),t.NdJ("click",function(){const l=t.CHM(e).$implicit;return t.oxw().onCheck(l)}),t.qZA(),t._uU(2),t.qZA()}if(2&i){const e=s.$implicit;t.xp6(2),t.AsE(" ",e.route," - ",e.travel," ")}}function Y(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"div",21),t.TgZ(1,"a",22),t.NdJ("click",function(){return t.CHM(e),t.oxw().confirmSave()}),t._uU(2,"Guardar"),t.qZA(),t.qZA()}}const $=function(){return["fas","sync-alt"]};let H=(()=>{class i{constructor(e,n,o,l,a,d,p){this.pickingService=e,this.datePipe=n,this.fb=o,this.authService=l,this.common=a,this.bsModalRef=d,this.wsService=p,this.listLength=0,this.list=[],this.listChecked=[],this.title="Seleccionar Rutas",this.user=this.authService.user,this.message="",this.form=this.fb.group({date:[""]})}ngOnInit(){this.wsService.emit("picking"),this.formatedDate=this.datePipe.transform(Date.now(),"yyyy-MM-dd"),this.form.get("date").patchValue(this.formatedDate),this.suscription$=this.wsService.listen("to-picking").subscribe(()=>this.getList())}watch(){this.wsService.emit("picking"),this.list=[]}getList(){this.pickingService.listUserPicking(this.form.get("date").value).subscribe(e=>{this.list=e,this.message="",this.list.forEach(n=>{n.checked=!1})},e=>{this.message=e.error.message})}onCheck(e){e.checked=!e.checked}confirmSave(){const e=this;this.common.showConfirmSave("GUARDAR","Recuerda que una vez guardado no podr\xe1s modificar los datos. \xbfDeseas continuar?",function(o){o.isConfirmed&&(e.saveAllChecked(),e.common.showToast(`Se han guardado ${e.listChecked.length} datos correctamente.`))})}saveAllChecked(){this.listChecked=[],this.list.forEach(e=>{e.checked&&(delete e.checked,e.user=this.user.uid,this.listChecked.push(e))}),this.pickingService.saveListByUser(this.listChecked).subscribe(e=>{this.wsService.emit("picking")}),this.bsModalRef.hide()}back(){window.history.back()}ngOnDestroy(){this.suscription$.unsubscribe()}closeModal(){this.bsModalRef.hide()}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(h),t.Y36(u.uU),t.Y36(c.qu),t.Y36(k.e),t.Y36(q.v_),t.Y36(Z.UZ),t.Y36(L.i))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-select-routes"]],inputs:{listLength:"listLength"},decls:21,vars:8,consts:[[1,"modal-header"],[1,"modal-title","pull-left"],["class","btn btn-danger",3,"click",4,"ngIf"],["type","button",1,"btn","btn-sm","btn-info","ms-1",3,"click"],[1,"modal-body"],[1,"row"],[1,"col-md-3","d-flex",3,"formGroup"],["type","date","formControlName","date",1,"form-control","mr-2"],["type","button",1,"btn","btn-sm","btn-danger","ms-1",3,"click"],[1,"col-md-8"],[1,"col-md-1","d-flex","justify-content-center"],[1,"btn","btn-link",3,"click"],[3,"icon"],[1,"border","mt-4"],["class","text-center mt-4 fw-bold",4,"ngIf"],["class","m-3",4,"ngFor","ngForOf"],["class","text-center mt-4",4,"ngIf"],[1,"btn","btn-danger",3,"click"],[1,"text-center","mt-4","fw-bold"],[1,"m-3"],["type","checkbox",1,"form-check-input","largerCheckBox","me-2","mt-0","fw-bold",3,"click"],[1,"text-center","mt-4"],[1,"btn","btn-success",3,"click"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"h4",1),t._uU(2),t.qZA(),t.YNc(3,B,2,0,"a",2),t.TgZ(4,"button",3),t.NdJ("click",function(){return n.back()}),t._uU(5,"Atr\xe1s"),t.qZA(),t.qZA(),t.TgZ(6,"div",4),t.TgZ(7,"div",5),t.TgZ(8,"div",6),t._UZ(9,"input",7),t.TgZ(10,"button",8),t.NdJ("click",function(){return n.watch()}),t._uU(11,"Ver"),t.qZA(),t.qZA(),t._UZ(12,"div",9),t.TgZ(13,"div",10),t.TgZ(14,"button",11),t.NdJ("click",function(){return n.watch()}),t._UZ(15,"fa-icon",12),t.qZA(),t.qZA(),t.qZA(),t.TgZ(16,"div",13),t.YNc(17,Q,3,3,"h3",14),t.YNc(18,j,3,2,"label",15),t._UZ(19,"br"),t.qZA(),t.YNc(20,Y,3,0,"div",16),t.qZA()),2&e&&(t.xp6(2),t.Oqu(n.title),t.xp6(1),t.Q6J("ngIf",n.listLength>0),t.xp6(5),t.Q6J("formGroup",n.form),t.xp6(7),t.Q6J("icon",t.DdM(7,$)),t.xp6(2),t.Q6J("ngIf",n.message),t.xp6(1),t.Q6J("ngForOf",n.list),t.xp6(2),t.Q6J("ngIf",n.list.length>0))},directives:[u.O5,c.JL,c.sg,c.Fj,c.JJ,c.u,g.BN,u.sg],pipes:[u.gd],styles:["input.largerCheckBox[_ngcontent-%COMP%]{width:25px;height:25px}  .modal-dialog{max-width:95vw;max-height:95vh;width:1500px;height:800px}  .modal-content{height:100%}"]}),i})();const z=function(){return["fas","check"]};function E(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"tr",12),t.TgZ(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td",13),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.qZA(),t.TgZ(7,"td"),t.TgZ(8,"button",14),t.NdJ("click",function(){const l=t.CHM(e).$implicit;return t.oxw().check(l)}),t._UZ(9,"fa-icon",15),t.qZA(),t.qZA(),t.qZA()}if(2&i){const e=s.$implicit,n=s.index;t.Q6J("ngClass",e.complete?"bg-success text-white":""),t.xp6(2),t.Oqu(n+1),t.xp6(2),t.Oqu(null==e?null:e.name),t.xp6(2),t.Oqu(null==e?null:e.units),t.xp6(2),t.Q6J("disabled",e.complete),t.xp6(1),t.Q6J("icon",t.DdM(6,z))}}let G=(()=>{class i{constructor(e,n){this.pickingService=e,this.bsModalRef=n,this.picking="",this.units=[]}ngOnInit(){this.getDetail()}onConfirm(){this.bsModalRef.content.onClose.next(!0),this.bsModalRef.hide()}onCancel(){this.bsModalRef.content.onClose.next(!1),this.bsModalRef.hide()}check(e){this.pickingService.check(e._id,{complete:!0}).subscribe(()=>this.getDetail())}getDetail(){this.pickingService.listDetail(this.picking._id).subscribe(e=>{this.units=e.detail.filter(n=>n.units>0)})}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(h),t.Y36(Z.UZ))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-unit-detail"]],inputs:{picking:"picking"},decls:32,vars:4,consts:[[1,"scrollModal"],[1,"modal-header"],[1,"modal-title","d-flex","justify-content-between","w-100"],[1,"modal-body"],[1,"table-responsive"],[1,"table","table-sm","table-bordered"],[1,"fw-bold","text-center","table-primary",2,"font-size","14px"],["class","text-center align-middle",3,"ngClass",4,"ngFor","ngForOf"],[1,"text-center","align-middle"],["colspan","2"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary","btn-mobile",3,"click"],[1,"text-center","align-middle",3,"ngClass"],[1,"text-start"],[1,"btn","btn-success",3,"disabled","click"],[3,"icon"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"div",1),t.TgZ(2,"h5",2),t.TgZ(3,"span"),t._uU(4,"Unidades"),t.qZA(),t.TgZ(5,"span"),t._uU(6),t.qZA(),t.TgZ(7,"span"),t._uU(8),t.qZA(),t.qZA(),t.qZA(),t.TgZ(9,"div",3),t.TgZ(10,"div",4),t.TgZ(11,"table",5),t.TgZ(12,"thead"),t.TgZ(13,"tr",6),t.TgZ(14,"th"),t._uU(15,"#"),t.qZA(),t.TgZ(16,"th"),t._uU(17,"Nombre"),t.qZA(),t.TgZ(18,"th"),t._uU(19,"Unidades"),t.qZA(),t.TgZ(20,"th"),t._uU(21,"Opciones"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(22,"tbody"),t.YNc(23,E,10,7,"tr",7),t.TgZ(24,"tr",8),t.TgZ(25,"th",9),t._uU(26,"Total"),t.qZA(),t.TgZ(27,"th"),t._uU(28),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(29,"div",10),t.TgZ(30,"button",11),t.NdJ("click",function(){return n.onCancel()}),t._uU(31,"Cerrar"),t.qZA(),t.qZA(),t.qZA()),2&e&&(t.xp6(6),t.hij("Ruta: ",null==n.picking?null:n.picking.route,""),t.xp6(2),t.hij("Viaje: ",null==n.picking?null:n.picking.travel,""),t.xp6(15),t.Q6J("ngForOf",n.units),t.xp6(5),t.Oqu(null==n.picking?null:n.picking.units))},directives:[u.sg,u.mk,g.BN],styles:[".scrollModal[_ngcontent-%COMP%]{max-width:95vw;max-height:95vh}.table-responsive[_ngcontent-%COMP%]{max-height:75vh}thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{position:sticky;top:0;z-index:10}"]}),i})();var V=r(5190),X=r(7028);function K(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"button",31),t.NdJ("click",function(){t.CHM(e);const o=t.oxw(),l=o.$implicit,a=o.index;return t.oxw().confirmStart(l,a)}),t._uU(1," Inicio "),t.qZA()}}function W(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"button",32),t.NdJ("click",function(){t.CHM(e);const o=t.oxw(),l=o.$implicit,a=o.index;return t.oxw().finish(l,a)}),t._uU(1," Fin "),t.qZA()}if(2&i){const e=t.oxw().$implicit;t.Q6J("disabled",void 0!==e.value.endTime)}}const A=function(){return{}};function tt(i,s){if(1&i&&(t.TgZ(0,"h5",33),t._uU(1),t.qZA()),2&i){const e=t.oxw().$implicit,n=t.oxw();t.Q6J("ngStyle",e.value.startTime?n.getColor(e):t.DdM(2,A)),t.xp6(1),t.hij(" ",null==e||null==e.value?null:e.value.currentTime," ")}}const b=function(){return["fas","eye"]},et=function(){return{"background-color":"#ff6961"}};function nt(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"tr",22),t.TgZ(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.qZA(),t.TgZ(7,"td"),t._uU(8),t.qZA(),t.TgZ(9,"td",12),t._uU(10),t.qZA(),t.TgZ(11,"td",12),t.TgZ(12,"fa-icon",26),t.NdJ("click",function(){const l=t.CHM(e).$implicit;return t.oxw().boxDetail(l)}),t.qZA(),t.qZA(),t.TgZ(13,"td",13),t._uU(14),t.qZA(),t.TgZ(15,"td",13),t.TgZ(16,"fa-icon",26),t.NdJ("click",function(){const l=t.CHM(e).$implicit;return t.oxw().bottleDetail(l)}),t.qZA(),t.qZA(),t.TgZ(17,"td",14),t._uU(18),t.qZA(),t.TgZ(19,"td",14),t.TgZ(20,"fa-icon",26),t.NdJ("click",function(){const l=t.CHM(e).$implicit;return t.oxw().packageDetail(l)}),t.qZA(),t.qZA(),t.TgZ(21,"td",15),t._uU(22),t.qZA(),t.TgZ(23,"td",15),t.TgZ(24,"fa-icon",26),t.NdJ("click",function(){const l=t.CHM(e).$implicit;return t.oxw().unitDetail(l)}),t.qZA(),t.qZA(),t.TgZ(25,"td"),t.YNc(26,K,2,0,"button",27),t.YNc(27,W,2,1,"button",28),t.qZA(),t.TgZ(28,"td",29),t.YNc(29,tt,2,3,"h5",30),t.qZA(),t.TgZ(30,"td"),t._uU(31),t.qZA(),t.qZA()}if(2&i){const e=s.$implicit,n=s.index;t.xp6(2),t.Oqu(n+1),t.xp6(2),t.Oqu(null==e||null==e.value?null:e.value.plaque),t.xp6(2),t.Oqu(null==e||null==e.value?null:e.value.route),t.xp6(2),t.Oqu(null==e||null==e.value?null:e.value.travel),t.xp6(2),t.hij(" ",null==e||null==e.value?null:e.value.boxes," "),t.xp6(2),t.Q6J("icon",t.DdM(17,b)),t.xp6(2),t.hij(" ",null==e||null==e.value?null:e.value.bottles," "),t.xp6(2),t.Q6J("icon",t.DdM(18,b)),t.xp6(2),t.hij(" ",null==e||null==e.value?null:e.value.packages," "),t.xp6(2),t.Q6J("icon",t.DdM(19,b)),t.xp6(2),t.hij(" ",null==e||null==e.value?null:e.value.units," "),t.xp6(2),t.Q6J("icon",t.DdM(20,b)),t.xp6(2),t.Q6J("ngIf",!e.value.startTime&&!e.value.endTime),t.xp6(1),t.Q6J("ngIf",e.value.startTime),t.xp6(1),t.Q6J("ngStyle",null!=e&&null!=e.value&&e.value.start?t.DdM(21,et):t.DdM(22,A)),t.xp6(1),t.Q6J("ngIf",e.value.startTime),t.xp6(2),t.Oqu(null==e||null==e.value?null:e.value.totalUnits)}}function it(i,s){if(1&i&&(t.TgZ(0,"tr",22),t.TgZ(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.ALo(5,"date"),t.qZA(),t.TgZ(6,"td"),t._uU(7),t.ALo(8,"date"),t.qZA(),t.TgZ(9,"td"),t._uU(10),t.ALo(11,"date"),t.qZA(),t.TgZ(12,"td"),t._uU(13),t.qZA(),t.TgZ(14,"td"),t._uU(15),t.qZA(),t.TgZ(16,"td",23),t._uU(17),t.qZA(),t.qZA()),2&i){const e=s.$implicit,n=s.index,o=t.oxw();t.xp6(2),t.Oqu(n+1),t.xp6(2),t.Oqu(t.xi3(5,8,e.endTime,"MM/dd/yy")),t.xp6(3),t.Oqu(t.xi3(8,11,e.startTime,"HH:mm")),t.xp6(3),t.Oqu(t.xi3(11,14,e.endTime,"HH:mm")),t.xp6(3),t.Oqu(e.boxes),t.xp6(2),t.Oqu(o.gm.convertMsToHMByItem(e)),t.xp6(1),t.Q6J("ngStyle",o.getColorUni(e)),t.xp6(1),t.Oqu(o.calculateProductivity(e))}}const ot=function(){return["fas","clock"]},st=[{path:"",component:y,children:[{path:"enlistment",component:(()=>{class i{constructor(e,n,o,l,a,d,p,rt){this.fb=e,this.pickingService=n,this.campusService=o,this.authService=l,this.modalService=a,this.datePipe=d,this.common=p,this.gm=rt,this.user=this.authService.user,this.meta=0,this.metaGreen=0,this.totalBoxes=0,this.totalTime=0,this.totalGap=0,this.totalProductivity=0,this.resumenList=[],this.now=new Date,this.form=this.fb.group({items:this.fb.array([]),date:[""]})}ngOnInit(){this.getCampus(),this.formatedDate=this.datePipe.transform(Date.now(),"yyyy-MM-dd"),this.form.get("date").patchValue(this.formatedDate),this.getStatus()}getCampus(){const{campus:e}=this.authService.user;this.campusService.getCampusByCode(e).subscribe(n=>{n&&(this.meta=n.goalPicking,this.metaGreen=Math.round(.9*this.meta))})}colorize(e){return e>0&&e<this.metaGreen?{"background-color":"#ff0000",color:"#fff"}:e>=this.metaGreen&&e<this.meta?{"background-color":"#ffd700",color:"#000"}:e>=this.meta?{"background-color":"#00b050",color:"#fff"}:{"background-color":"#fff",color:"#000"}}countdown(e,n){const o=new Date(n).getTime(),l=(new Date).getTime();e.gap=l-o,e.currentTime=this.gm.convertMsToTime(e.gap)}getHourLimit(e,n,o){e.milliHoursLimit=n/o*60*60*1e3}getColor(e){const n=new Date(e.value.startTime).getTime(),l=(void 0!==e.value.endTime?new Date(e.value.endTime).getTime():(new Date).getTime())-n,a=parseInt(e.value.boxes),d=Math.round(100*(l/36e5+Number.EPSILON))/100,p=Math.round(a/d);return this.colorize(p)}getStatus(){this.pickingService.statusUser(this.form.get("date").value).subscribe(e=>{e.ok?this.getPickings():e.ok||this.openModal()})}openModal(){this.subCategoryRef=this.modalService.show(H,{class:"modal-dialog-centered modal-lg",keyboard:!1,backdrop:"static",initialState:{listLength:this.form.get("items").value.length}}),this.modalService.onHide.subscribe(e=>{this.getPickings()})}getPickings(){this.pickingService.list(this.form.get("date").value).subscribe(e=>{this.form.setControl("items",this.fb.array([]));const n=this.form.get("items");e&&e.length>0&&Object.keys(e).forEach(o=>{n.push(this.fb.group({_id:new c.NI({value:e[o]._id,disabled:!0}),route:new c.NI({value:e[o].route,disabled:!0}),travel:new c.NI({value:e[o].travel,disabled:!0}),plaque:new c.NI({value:e[o].plaque,disabled:!0}),boxes:new c.NI({value:e[o].boxes,disabled:!0}),bottles:new c.NI({value:e[o].bottles,disabled:!0}),packages:new c.NI({value:e[o].packages,disabled:!0}),units:new c.NI({value:e[o].units,disabled:!0}),startTime:new c.NI({value:e[o].startTime,disabled:!0}),endTime:new c.NI({value:e[o].endTime,disabled:!0}),totalUnits:new c.NI({value:e[o].totalUnits,disabled:!0}),preparer:new c.NI({value:this.user.uid,disabled:!0}),start:new c.NI({value:e[o].start,disabled:!0}),currentTime:new c.NI({value:e[o].currentTime||"00:00:00",disabled:!0}),milliHoursLimit:new c.NI({value:e[o].milliHoursLimit||0,disabled:!0}),gap:new c.NI({value:e[o].gap||0,disabled:!0})}))}),this.totalBoxes=0,this.totalTime=0,this.totalProductivity=0,this.totalGap=0,this.resumenList=[],this.form.get("items").value.map(o=>{void 0!==o.startTime&&void 0!==o.endTime&&this.resumenList.push(o)}),this.resumenList.sort((o,l)=>new Date(o.endTime).getTime()-new Date(l.endTime).getTime()),this.resumenList.forEach(o=>{this.totalBoxes+=parseInt(o.boxes),this.totalTime+=this.calculateTime(o);const l=new Date(o.startTime).getTime(),d=new Date(o.endTime).getTime()-l;this.totalGap+=d}),this.resumenList.length>0&&(this.totalProductivity=Math.round(this.totalBoxes/this.totalTime)),this.interval2=setInterval(()=>{n.controls.forEach((o,l)=>{o.value.start&&(this.getHourLimit(o.value,o.value.boxes,this.meta),this.countdown(o.value,o.value.startTime),this.getColor(o))}),n.controls.every(o=>!1===o.value.start)&&clearInterval(this.interval2)},250)})}confirmStart(e,n){const o=this;this.common.showConfirmStart("CONTAR","Recuerda que una vez iniciado el conteo no podr\xe1s cambiarlo. \xbfDeseas continuar? ",function(a){a.isConfirmed&&o.start(e,n)})}confirmFinish(e,n){const o=this;this.common.showConfirmEnd("FINALIZAR","Recuerda que una vez finalizado el conteo no podr\xe1s cambiarlo. \xbfDeseas continuar? ",function(a){a.isConfirmed&&o.finish(e,n)})}start(e,n){this.form.get("items").controls[n].patchValue({startTime:new Date,start:!0}),this.pickingService.update(e.value._id,this.form.get("items").controls[n].value).subscribe(),this.interval=setInterval(()=>{e.value.start&&(this.getHourLimit(e.value,e.value.boxes,this.meta),this.countdown(e.value,e.value.startTime),this.getColor(e))},1e3)}finish(e,n){this.form.get("items").controls[n].patchValue({milliHoursLimit:e.value.milliHoursLimit,currentTime:e.value.currentTime,endTime:new Date,gap:e.value.gap,start:!1}),clearInterval(this.interval),this.pickingService.update(e.value._id,this.form.get("items").controls[n].value).subscribe(o=>{o&&this.getPickings()})}boxDetail(e){this.subCategoryRef=this.modalService.show(J,{class:"modal-dialog-centered modal-lg",initialState:{picking:e.value}}),this.subCategoryRef.content.onClose=new _.x}bottleDetail(e){this.subCategoryRef=this.modalService.show(S,{class:"modal-dialog-centered modal-lg",initialState:{picking:e.value}}),this.subCategoryRef.content.onClose=new _.x}packageDetail(e){this.subCategoryRef=this.modalService.show(F,{class:"modal-dialog-centered modal-lg",initialState:{picking:e.value}}),this.subCategoryRef.content.onClose=new _.x}unitDetail(e){this.subCategoryRef=this.modalService.show(G,{class:"modal-dialog-centered modal-lg",initialState:{picking:e.value}}),this.subCategoryRef.content.onClose=new _.x}calculateTime(e){const n=new Date(e.startTime).getTime(),o=new Date(e.endTime).getTime();return e.gap=o-n,Math.round(100*(e.gap/36e5+Number.EPSILON))/100}calculateProductivity(e){const n=parseInt(e.boxes),o=this.calculateTime(e);return Math.round(n/o)}getColorUni(e){const n=new Date(e.startTime).getTime(),l=new Date(e.endTime).getTime()-n,a=parseInt(e.boxes),d=Math.round(100*(l/36e5+Number.EPSILON))/100,p=Math.round(a/d);return this.colorize(p)}getColorTotal(){const e=Math.round(100*(this.totalGap/36e5+Number.EPSILON))/100,n=Math.round(this.totalBoxes/e);return this.colorize(n)}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(c.qu),t.Y36(h),t.Y36(V.j),t.Y36(k.e),t.Y36(Z.tT),t.Y36(u.uU),t.Y36(q.v_),t.Y36(X.t))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-picking"]],decls:99,vars:11,consts:[[1,"container-fluid"],[1,"row"],[1,"col-md-2","d-flex",3,"formGroup"],["type","date","formControlName","date",1,"form-control","mr-2"],["type","button",1,"btn","btn-sm","btn-danger","ms-1",3,"click"],[1,"col-md-9","mb-2"],[1,"col-md-1"],["type","button",1,"btn","btn-sm","btn-primary","ms-1",3,"click"],[1,"col-md-8"],[1,"table-responsive","mt-3"],[1,"table","table-sm","table-striped","table-bordered",3,"formGroup"],[1,"fw-bold","text-center","table-primary",2,"font-size","14px"],[2,"background-color","#f7dae5"],[2,"background-color","#e2f0cb"],[2,"background-color","#c3e2e6"],[2,"background-color","#d0cce0"],[2,"width","62px"],["size","lg",3,"icon"],[2,"width","200px"],["class","text-center align-middle",4,"ngFor","ngForOf"],[1,"col-md-4"],[1,"table","table-sm","table-bordered"],[1,"text-center","align-middle"],[3,"ngStyle"],[1,"text-center","align-middle",2,"background-color","#e9ecef"],[2,"width","130px"],["size","lg",1,"eye",3,"icon","click"],["type","button","class","btn btn-primary btn-sm",3,"click",4,"ngIf"],["type","button","class","btn btn-secondary btn-sm",3,"disabled","click",4,"ngIf"],[1,"p-1",3,"ngStyle"],["class","mb-0 fw-bold text-center","style","padding: 6px 0",3,"ngStyle",4,"ngIf"],["type","button",1,"btn","btn-primary","btn-sm",3,"click"],["type","button",1,"btn","btn-secondary","btn-sm",3,"disabled","click"],[1,"mb-0","fw-bold","text-center",2,"padding","6px 0",3,"ngStyle"]],template:function(e,n){if(1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"div",1),t.TgZ(2,"form",2),t._UZ(3,"input",3),t.TgZ(4,"button",4),t.NdJ("click",function(){return n.getPickings()}),t._uU(5,"Ver"),t.qZA(),t.qZA(),t._UZ(6,"div",5),t.TgZ(7,"div",6),t.TgZ(8,"button",7),t.NdJ("click",function(){return n.openModal()}),t._uU(9,"Seleccionar rutas"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(10,"div",0),t.TgZ(11,"div",1),t.TgZ(12,"div",8),t.TgZ(13,"div",9),t.TgZ(14,"table",10),t.TgZ(15,"thead"),t.TgZ(16,"tr",11),t.TgZ(17,"th"),t._uU(18,"#"),t.qZA(),t.TgZ(19,"th"),t._uU(20,"Placa"),t.qZA(),t.TgZ(21,"th"),t._uU(22,"Ruta"),t.qZA(),t.TgZ(23,"th"),t._uU(24,"Viaje"),t.qZA(),t.TgZ(25,"th",12),t._uU(26,"Cajas"),t.qZA(),t.TgZ(27,"th",12),t._uU(28,"Ver"),t.qZA(),t.TgZ(29,"th",13),t._uU(30,"Botellas"),t.qZA(),t.TgZ(31,"th",13),t._uU(32,"Ver"),t.qZA(),t.TgZ(33,"th",14),t._uU(34,"Paquetes"),t.qZA(),t.TgZ(35,"th",14),t._uU(36,"Ver"),t.qZA(),t.TgZ(37,"th",15),t._uU(38,"Unidades"),t.qZA(),t.TgZ(39,"th",15),t._uU(40,"Ver"),t.qZA(),t.TgZ(41,"th",16),t._UZ(42,"fa-icon",17),t.qZA(),t.TgZ(43,"th",18),t._uU(44,"Tiempo"),t.qZA(),t.TgZ(45,"th"),t._uU(46,"Total Unidades"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(47,"tbody"),t.YNc(48,nt,32,23,"tr",19),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(49,"div",20),t.TgZ(50,"table",21),t.TgZ(51,"thead"),t.TgZ(52,"tr",22),t.TgZ(53,"th"),t._uU(54,"#"),t.qZA(),t.TgZ(55,"th"),t._uU(56,"Fecha"),t.qZA(),t.TgZ(57,"th"),t._uU(58,"Inicio"),t.qZA(),t.TgZ(59,"th"),t._uU(60,"Fin"),t.qZA(),t.TgZ(61,"th"),t._uU(62,"Cajas"),t.qZA(),t.TgZ(63,"th"),t._uU(64,"Tiempo"),t._UZ(65,"br"),t._uU(66,"(hh:mm)"),t.qZA(),t.TgZ(67,"th"),t._uU(68,"Productividad"),t._UZ(69,"br"),t._uU(70,"(cjs/hora)"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(71,"tbody"),t.YNc(72,it,18,17,"tr",19),t.TgZ(73,"tr",22),t.TgZ(74,"th"),t._uU(75,"Total"),t.qZA(),t._UZ(76,"th"),t._UZ(77,"th"),t._UZ(78,"th"),t.TgZ(79,"th"),t._uU(80),t.qZA(),t.TgZ(81,"th"),t._uU(82),t.qZA(),t.TgZ(83,"th",23),t._uU(84),t.qZA(),t.qZA(),t.TgZ(85,"tr"),t._UZ(86,"td"),t.qZA(),t.TgZ(87,"tr",24),t._UZ(88,"td"),t._UZ(89,"td"),t._UZ(90,"td"),t._UZ(91,"td"),t.TgZ(92,"td",25),t.TgZ(93,"small"),t._uU(94,"Meta Productividad"),t.qZA(),t.qZA(),t.TgZ(95,"td"),t._uU(96),t.qZA(),t.TgZ(97,"td"),t._uU(98,"cjs/hora"),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA()),2&e){let o;t.xp6(2),t.Q6J("formGroup",n.form),t.xp6(12),t.Q6J("formGroup",n.form),t.xp6(28),t.Q6J("icon",t.DdM(10,ot)),t.xp6(6),t.Q6J("ngForOf",null==(o=n.form.get("items"))?null:o.controls),t.xp6(24),t.Q6J("ngForOf",n.resumenList),t.xp6(8),t.Oqu(n.totalBoxes),t.xp6(2),t.Oqu(n.gm.convertMsToHM(n.totalGap)),t.xp6(1),t.Q6J("ngStyle",n.getColorTotal()),t.xp6(1),t.Oqu(n.totalProductivity),t.xp6(12),t.Oqu(n.meta)}},directives:[c._Y,c.JL,c.sg,c.Fj,c.JJ,c.u,g.BN,u.sg,u.O5,u.PC],pipes:[u.uU],styles:[".eye[_ngcontent-%COMP%]{cursor:pointer}.eye[_ngcontent-%COMP%]:hover{color:#fff}"]}),i})()},{path:"",redirectTo:"enlistment",pathMatch:"full"}]}];let lt=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[[T.Bz.forChild(st)],T.Bz]}),i})();var ct=r(6802),f=r(801);let at=(()=>{class i{constructor(e){e.addIcons(f.SZw,f.Mdf,f.d8e,f.LEp)}}return i.\u0275fac=function(e){return new(e||i)(t.LFG(g.by))},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[[u.ez,lt,ct.m,c.UX,g.uH]]}),i})()}}]);